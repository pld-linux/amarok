author: shadzik@pld-linux.org

--- src/context/engines/wikipedia/WikipediaEngine.h.orig	2009-02-12 22:25:48.295155524 +0100
+++ src/context/engines/wikipedia/WikipediaEngine.h	2009-02-12 23:21:12.984509845 +0100
@@ -21,6 +21,7 @@
 #include <context/DataEngine.h>
 
 #include <KIO/Job>
+#include <QLocale>
 
 /**
     This class provide Wikipedia data for use in Context applets. 
@@ -66,8 +67,8 @@
     QString wikiAlbumPostfix();
     QString wikiTrackPostfix();
     QString wikiSiteUrl();
-    QString wikiUrl( const QString& item ) const;
-    QString wikiLocale() const;
+    QString wikiUrl( const QString& item );
+    QString wikiLocale();
     
     void reloadWikipedia();
     
@@ -80,6 +81,7 @@
     QString m_wikiCurrentEntry;
     QString m_wikiCurrentUrl;
     QString m_wikiLanguages;
+    QLocale m_wikiLang;
     QString m_wikiLocale;
     // stores what features are enabled
     bool m_requested;
--- src/context/engines/wikipedia/WikipediaEngine.cpp.orig	2009-02-12 22:11:01.234729628 +0100
+++ src/context/engines/wikipedia/WikipediaEngine.cpp	2009-02-12 23:21:17.993249676 +0100
@@ -27,7 +27,7 @@
     , ContextObserver( ContextView::self() )
     , m_wikiJob( 0 )
     , m_currentSelection( "artist" )
-    , m_wikiLocale( "en" )
+    , m_wikiLocale( "" )
     , m_requested( true )
     , m_sources( "current" )
     , m_triedRefinedSearch( false )
@@ -327,9 +327,11 @@
 }
 
 inline QString
-WikipediaEngine::wikiLocale() const
+WikipediaEngine::wikiLocale()
 {
-    return !m_wikiLocale.isEmpty() ? m_wikiLocale : QString( "en" );
+    m_wikiLocale = m_wikiLang.name().split('_')[0];
+    //return !m_wikiLocale.isEmpty() ? m_wikiLocale : QString( "en" );
+    return m_wikiLocale;
 }
 
 inline QString
@@ -339,6 +341,8 @@
         return " (band)";
     else if( wikiLocale() == "de" )
         return " (Band)";
+    else if( wikiLocale() == "pl" )
+        return " (Kapela)";
     return QString();
 }
 
@@ -355,7 +359,7 @@
 }
 
 inline QString
-WikipediaEngine::wikiUrl( const QString &item ) const
+WikipediaEngine::wikiUrl( const QString &item )
 {
     return QString( "http://%1.wikipedia.org/wiki/" ).arg( wikiLocale() ) + KUrl::toPercentEncoding( item, "/" );
 }
