--- amarok-1.3.6/amarok/src/ktrm.cpp.orig	2005-11-07 23:19:18.000000000 +0100
+++ amarok-1.3.6/amarok/src/ktrm.cpp	2005-11-17 12:24:43.006638250 +0100
@@ -42,7 +42,7 @@
 
 extern "C"
 {
-    static void TRMNotifyCallback(tunepimp_t pimp, void *data, TPCallbackEnum type, int fileId);
+    static void TRMNotifyCallback(tunepimp_t pimp, void *data, TPCallbackEnum type, int fileId, TPFileStatus);
 }
 
 /**
@@ -66,7 +66,7 @@
         int id;
 
         if(!m_fileMap.contains(lookup->file())) {
-            id = tp_AddFile(m_pimp, QFile::encodeName(lookup->file()));
+            id = tp_AddFile(m_pimp, QFile::encodeName(lookup->file()), 1);
             m_fileMap.insert(lookup->file(), id);
         }
         else {
@@ -121,7 +121,7 @@
         tp_SetAutoSaveThreshold(m_pimp, -1);
         tp_SetMoveFiles(m_pimp, false);
         tp_SetRenameFiles(m_pimp, false);
-        tp_SetUseUTF8(m_pimp, true);
+        tp_SetID3Encoding(m_pimp, eUTF8);
         tp_SetNotifyCallback(m_pimp, TRMNotifyCallback, 0);
 
         if(KProtocolManager::useProxy()) {
@@ -245,7 +245,7 @@
  * Callback fuction for TunePimp lookup events.
  */
 
-static void TRMNotifyCallback(tunepimp_t pimp, void *, TPCallbackEnum type, int fileId)
+static void TRMNotifyCallback(tunepimp_t pimp, void *, TPCallbackEnum type, int fileId, TPFileStatus)
 {
     if(type != tpFileChanged)
         return;
@@ -556,10 +556,10 @@
                 KTRMResult result;
 
                 result.d->title = QString::fromUtf8(tracks[i]->name);
-                result.d->artist = QString::fromUtf8(tracks[i]->artist->name);
-                result.d->album = QString::fromUtf8(tracks[i]->album->name);
+                result.d->artist = QString::fromUtf8(tracks[i]->artist.name);
+                result.d->album = QString::fromUtf8(tracks[i]->album.name);
                 result.d->track = tracks[i]->trackNum;
-                result.d->year = tracks[i]->album->releaseYear;
+                result.d->year = tracks[i]->album.releaseYear;
                 result.d->relevance =
                     4 * stringSimilarity(strList,result.d->title) +
                     2 * stringSimilarity(strList,result.d->artist) +
